<launch>
  <arg name="MANAGER"           default="filter_cart_pointcloud_manager" />
  <arg name="INPUT_CLOUD"       default="/accumulated_heightmap_pointcloud/output" />
  <arg name="rviz"              default="true" />

  <!-- nodelet manager -->
  <node name="$(arg MANAGER)" pkg="nodelet" type="nodelet" args="manager" />

  <!-- transform original pointcloud to /BODY_on_map frame -->
  <node name="pointcloud_from_robot"
        pkg="nodelet" type="nodelet"
        args="load jsk_pcl_utils/TfTransformCloud /$(arg MANAGER)">
    <remap from="~input" to="$(arg INPUT_CLOUD)" />
    <rosparam>
      target_frame_id: BODY_on_map
      tf_queue_size: 3
    </rosparam>
  </node>

  <!-- crop cart pointcloud -->
  <node pkg="nodelet" type="nodelet" name="cropbox"
        args="load pcl/CropBox /$(arg MANAGER)" output="screen">
    <remap from="~input" to="pointcloud_from_robot/output" />
    <rosparam>
      min_x: -0.2
      max_x:  1.2
      min_y: -0.4
      max_y:  0.4
      min_z: -0.5
      max_z:  2.5
      negative: True
    </rosparam>
  </node>

  <!-- transform filtered pointcloud to /map frame -->
  <node name="filter_cart_pointcloud"
        pkg="nodelet" type="nodelet"
        args="standalone jsk_pcl_utils/TfTransformCloud /$(arg MANAGER)">
    <remap from="~input" to="cropbox/output" />
    <rosparam>
      target_frame_id: map
      tf_queue_size: 3
    </rosparam>
  </node>

  <!-- visualize -->
  <node name="rviz" pkg="rviz" type="rviz"
        args="-d $(find jsk_footstep_planner)/config/filter_cart_pointcloud.rviz"
        output="screen" if="$(arg rviz)"/>

</launch>
